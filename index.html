<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dinosauroscopes ðŸ¦•</title>
  <script src="https://js.puter.com/v2"></script>
  <style>
    body {
      font-family: sans-serif;
      max-width: 700px;
      margin: auto;
      padding: 2rem;
      background-color: #f8f6ef;
      color: #333;
    }
    h1 {
      text-align: center;
      margin-bottom: 1rem;
    }
    #today {
      font-style: italic;
      text-align: center;
      margin-bottom: 2rem;
    }
    .dino {
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #ccc;
    }
    .dino h2 {
      margin-bottom: 0.3rem;
      font-size: 1.2rem;
      color: #5a713b;
    }
    .loading {
      text-align: center;
      color: #888;
      margin-top: 2rem;
    }
  </style>
</head>
<body>
  <h1>Dinosauroscopes ðŸ¦–</h1>
  <div id="today"></div>
  <div id="horoscope-container"></div>
  <div id="loading" class="loading" style="display:none;">Generating your horoscopes...</div>

  <script>
    const dinosaurs = [
      "Tyrannosaurus Rex","Triceratops","Stegosaurus","Velociraptor",
      "Brachiosaurus","Ankylosaurus","Spinosaurus","Pachycephalosaurus",
      "Dilophosaurus","Allosaurus","Iguanodon","Carnotaurus"
    ];

    function getToday() {
      return new Date().toISOString().split("T")[0];
    }

    async function getHoroscopes() {
      document.getElementById("loading").style.display = "block";
      const today = getToday();
      document.getElementById("today").textContent = `Today is ${today}`;

      const savedDate = localStorage.getItem("dinoDate");
      const savedData = localStorage.getItem("dinoHoroscopes");

      if (savedDate === today && savedData) {
        render(JSON.parse(savedData));
        document.getElementById("loading").style.display = "none";
        return;
      }

      const prompt = `
Generate a JSON object for dinosaur horoscopes dated ${today}.
Each horoscope should reflect experiences that dinosaur species might have today.
If today is Friday, focus on dinosaur romance.
Use these keys: ${dinosaurs.join(", ")}.
Return only valid JSON, e.g.:
{
  "date": "${today}",
  "Tyrannosaurus Rex": "You may find unexpected companionship near the watering hole.",
  ...
}
      `.trim();

    try {
    document.getElementById("loading").style.display = "block";
    const prompt = `â€¦`;        // your existing prompt

    // 1) call puter.js
    const aiResp = await puter.ai.chat(prompt, { model: "gpt-4.1-nano" });

    // 2) pull out the actual chat text
    let text;
    if (typeof aiResp === "string") text = aiResp;
    else if (aiResp.content) text = aiResp.content;
    else if (aiResp.choices?.[0]?.message?.content) {
        text = aiResp.choices[0].message.content;
    }
    else throw new Error("Unexpected AI response: " + JSON.stringify(aiResp));

    // 3) turn into JSON
    const jsonData = JSON.parse(text.trim());

    // 4) cache + render
    localStorage.setItem("dinoHoroscopes", JSON.stringify(jsonData));
    localStorage.setItem("dinoDate", getToday());
    render(jsonData);
    }
    catch (err) {
    console.error("Failed to generate horoscopes", err);
    }
    finally {
    document.getElementById("loading").style.display = "none";
    }

    }

    function render(data) {
      const container = document.getElementById("horoscope-container");
      container.innerHTML = "";
      dinosaurs.forEach(dino => {
        const message = data[dino] || "ðŸ¦• No prophecy available.";
        const div = document.createElement("div");
        div.className = "dino";
        div.innerHTML = `<h2>${dino}</h2><p>${message}</p>`;
        container.appendChild(div);
      });
    }

    getHoroscopes();
  </script>
</body>
</html>